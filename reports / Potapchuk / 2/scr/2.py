class Товар:
    def __init__(self, название, цена):
        self.название = название
        self.цена = цена

    def __str__(self):
        return f"{self.название} ({self.цена} руб.)"


class Пользователь:
    def __init__(self, имя):
        self.имя = имя


class Клиент(Пользователь):
    def __init__(self, имя, баланс=0):
        super().__init__(имя)
        self.баланс = баланс
        self.в_черном_списке = False

    def оплатить(self, сумма):
        if self.баланс >= сумма:
            self.баланс -= сумма
            return True
        return False


class Администратор(Пользователь):
    def добавить_товар(self, каталог, товар):
        каталог.append(товар)
        print(f"→ Админ {self.имя}: добавлен товар '{товар.название}'")

    def заблокировать(self, клиент):
        клиент.в_черном_списке = True
        print(f"!!! Админ {self.имя}: клиент {клиент.имя} занесён в ЧЁРНЫЙ СПИСОК!")


class Заказ:
    def __init__(self, клиент):
        self.клиент = клиент
        self.товары = []

    def добавить_товар(self, товар):
        self.товары.append(товар)

    def общая_стоимость(self):
        return sum(товар.цена for товар in self.товары)


class Магазин:
    def __init__(self, админ):
        self.админ = админ
        self.каталог = []
        self.продажи = []

    def зарегистрировать_продажу(self, заказ):
        if заказ.клиент.в_черном_списке:
            print(f"Отказ: клиент {заказ.клиент.имя} в чёрном списке.")
            return

        стоимость = заказ.общая_стоимость()
        print(f"Попытка оплаты заказа на {стоимость} руб.")

        if заказ.клиент.оплатить(стоимость):
            self.продажи.append(заказ)
            print(f"Успех: продажа оформлена для {заказ.клиент.имя}.")
        else:
            print(f"Ошибка: недостаточно средств у {заказ.клиент.имя}.")
            self.админ.заблокировать(заказ.клиент)


def main():
    try:
        имя_админа = input("Имя администратора магазина: ").strip()
        админ = Администратор(имя_админа)
        магазин = Магазин(админ)

        print("\n--- Добавление товаров (напишите 'стоп' для завершения) ---")
        while True:
            название = input("Название товара: ").strip()
            if название.lower() == "стоп":
                break
            try:
                цена = int(input(f"Цена '{название}': "))
                if цена < 0:
                    print("Цена не может быть отрицательной")
                    continue
                админ.добавить_товар(магазин.каталог, Товар(название, цена))
            except ValueError:
                print("Ошибка: введите целое число для цены")

        if not магазин.каталог:
            print("Каталог пуст → завершение программы")
            return

        print("\n--- Оформление заказа ---")
        имя_клиента = input("Имя клиента: ").strip()
        try:
            деньги = int(input(f"Сколько денег у {имя_клиента}? "))
            if деньги < 0:
                print("Баланс не может быть отрицательным")
                return
        except ValueError:
            print("Ошибка: введите целое число")
            return

        клиент = Клиент(имя_клиента, деньги)
        заказ = Заказ(клиент)

        print("\nДоступные товары:")
        for i, товар in enumerate(магазин.каталог):
            print(f"  {i:2d}. {товар}")

        ввод = input("\nНомера товаров через пробел (например: 0 2 1): ").strip()
        if not ввод:
            print("Заказ пуст")
            return

        for часть in ввод.split():
            try:
                индекс = int(часть)
                if 0 <= индекс < len(магазин.каталог):
                    заказ.добавить_товар(магазин.каталог[индекс])
                else:
                    print(f"Неверный номер: {часть} (игнорируется)")
            except ValueError:
                print(f"Некорректный ввод: {часть} (игнорируется)")

        if not заказ.товары:
            print("В заказ ничего не добавлено")
            return

        print("\n--- Результат ---")
        магазин.зарегистрировать_продажу(заказ)

        print(f"\nОстаток у клиента {клиент.имя}: {клиент.баланс} руб.")

    except Exception as e:
        print(f"Произошла ошибка: {e}")


if __name__ == "__main__":
    main()
